<!doctype html>
<html lang="es">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>AulaPudu â€” Aprende sin fronteras</title>

Â  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
Â  <script>
Â  Â  if (window.pdfjsLib) {
Â  Â  Â  pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js";
Â  Â  }
Â  </script>

Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

Â  <style>
Â  Â  /* --- INICIO: tu CSS EXACTO (no modificado) --- */
:root{
Â  --bg-top: #fff7ef;
Â  --bg-bottom: #bfe3d7;
Â  --text-dark: #134433;
Â  --muted: #315a52;
Â  --yellow: #f5cf66;
Â  --green: #88c1b2;
Â  --radius: 18px;
Â  --card-padding: 22px 28px;
Â  font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
Â  margin:0;
Â  color:var(--text-dark);
Â  background:linear-gradient(180deg,var(--bg-top) 20%, rgba(191,227,215,0.9) 60%, var(--bg-bottom) 100%);
Â  -webkit-font-smoothing:antialiased;
Â  -moz-osx-font-smoothing:grayscale;
}

/* Header */
.site-header{
Â  display:flex;
Â  justify-content:space-between;
Â  align-items:center;
Â  padding:36px 72px 0 72px;
}
.brand{
Â  display:flex;
Â  align-items:center;
Â  gap:14px;
}
.brand h1{
Â  margin:0;
Â  font-weight:700;
Â  color:var(--text-dark);
Â  font-size:28px;
}
.logo{
Â  width:56px;
Â  height:auto; /* mantiene proporciÃ³n */
}

/* Nav */
.nav{font-size:16px;color:var(--muted)}
.nav a{color:var(--muted); text-decoration:none; padding:0 8px}
.sep{color:var(--muted); opacity:0.6}

/* Hero */
.hero{
Â  position:relative;
Â  display:flex;
Â  align-items:center;
Â  justify-content:center;
Â  min-height:78vh;
Â  padding:20px 72px 60px 72px;
Â  overflow:hidden;
}
.pudu-big {
Â  position: fixed; Â  Â  /* en vez de absolute */
Â  left: 0;
Â  bottom: 0;
Â  height: 100vh; Â  Â  Â  /* ocupa toda la altura visible */
Â  width: auto;
Â  object-fit: contain;
Â  pointer-events: none;
Â  user-select: none;
Â  z-index: 1;
}



/* Content block */
.hero-content{
Â  width:54%;
Â  max-width:820px;
Â  text-align:center;
Â  z-index:2;
}
.eyebrow{
Â  letter-spacing:6px;
Â  font-weight:700;
Â  margin:0;
Â  color:var(--muted);
Â  font-size:18px;
}
.headline{
Â  font-size:72px;
Â  margin:8px 0 18px 0;
Â  line-height:0.95;
Â  color:var(--text-dark);
}
.subhead{
Â  margin:0 auto 34px auto;
Â  max-width:680px;
Â  line-height:1.6;
Â  font-size:20px;
Â  color:rgba(19,68,51,0.8);
}

/* CTA */
.cta-list{display:flex;flex-direction:column;gap:22px;align-items:center;margin-top:6px}
.cta{
Â  display:flex;
Â  align-items:center;
Â  gap:18px;
Â  text-decoration:none;
Â  min-width:520px;
Â  padding:var(--card-padding);
Â  border-radius:26px;
Â  box-shadow: 0 10px 30px rgba(18,60,50,0.08), inset 0 -6px 0 rgba(0,0,0,0.02);
Â  font-size:28px;
Â  font-weight:800;
Â  color:var(--text-dark);
Â  transition: all 0.2s; /* Added transition */
}
.cta:hover {
Â  transform: translateY(-2px);
Â  box-shadow: 0 12px 35px rgba(18,60,50,0.12), inset 0 -6px 0 rgba(0,0,0,0.02);
}
.cta-icon{
Â  width:72px;
Â  height:auto; /* mantiene proporciÃ³n */
Â  flex-shrink:0;
Â  object-fit:contain;
}

/* Specific colors */
.cta-yellow{background:linear-gradient(180deg,var(--yellow), #f0c85a)}
.cta-green{background:linear-gradient(180deg,var(--green), #79b9a6)}
button.red { background-color: #d9534f; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; }
button.red:hover { background-color: #c9302c; }


/* Responsive */
@media (max-width:980px){
Â  .hero-content{width:80%}
Â  .headline{font-size:44px}
Â  .cta{min-width:360px; font-size:22px}
Â  .pudu-big{max-width:65%} /* mÃ¡s grande tambiÃ©n en pantallas medianas */
}
/* --- INICIO: MEJORAS PARA MÃ“VIL (max-width: 640px) --- */
@media (max-width:640px){
Â  /* Layout principal y espaciado */
Â  .site-header{
Â  Â  padding: 20px 16px 0 16px; /* Reducir padding horizontal */
Â  }
Â  .hero{
Â  Â  padding: 20px 16px 60px 16px; /* Reducir padding horizontal */
Â  Â  min-height: 85vh; /* Aumentar el tamaÃ±o para aprovechar mÃ¡s el espacio */
Â  }
Â  .pudu-big{display:none}
Â Â 
Â  /* Marca y NavegaciÃ³n */
Â  .brand h1 { font-size: 24px; } /* Reducir el tamaÃ±o de la marca */
Â  .logo { width: 48px; } /* Reducir el tamaÃ±o del logo */
Â  .nav {
Â  Â  font-size: 14px; /* Reducir un poco el tamaÃ±o de la navegaciÃ³n */
Â  Â  display: flex;
Â  Â  align-items: center;
Â  }
Â  .nav a { padding: 0 6px; } /* Reducir el padding de los enlaces */

Â  /* Hero Content */
Â  .hero-content{
Â  Â  width: 100%; /* Usar todo el ancho */
Â  Â  max-width: none;
Â  Â  text-align: center;
Â  }
Â  .eyebrow{
Â  Â  font-size: 14px;
Â  Â  letter-spacing: 4px;
Â  }
Â  .headline{
Â  Â  font-size: 38px; /* TamaÃ±o de titular mÃ¡s apropiado */
Â  Â  line-height: 1.1;
Â  Â  margin: 4px 0 12px 0;
Â  }
Â  .subhead{
Â  Â  font-size: 16px;
Â  Â  margin-bottom: 24px;
Â  }

Â  /* CTA List */
Â  .cta-list { gap: 16px; } /* Reducir el espacio entre CTAs */
Â  .cta{
Â  Â  min-width: 100%; /* Ocupar todo el ancho disponible */
Â  Â  justify-content: flex-start;
Â  Â  padding: 18px 24px; /* Ajustar el padding */
Â  Â  font-size: 20px; /* Reducir el tamaÃ±o de fuente */
Â  }
Â  .cta-icon{width:48px;height:auto}

Â  /* App Shell (Contenido Interno) */
Â  .app-shell {
Â  Â  padding: 0 16px 60px 16px; /* Reducir el padding horizontal */
Â  }

Â  /* Formularios (Login/Join) */
Â  .auth-form, .spectator-input-card {
Â  Â  padding: 30px 20px; /* Reducir el padding interno */
Â  }
Â  .auth-form h2, .spectator-input-card h2 { font-size: 24px; }

Â  /* Dashboard Layout */
Â  .presenter-dashboard {
Â  Â  flex-direction: column; /* Apilar sidebar y main-content */
Â  Â  gap: 20px;
Â  Â  margin-top: 20px !important;
Â  }

Â  /* Sidebar */
Â  .sidebar {
Â  Â  width: 100%; /* Ocupar todo el ancho */
Â  Â  padding: 10px 0;
Â  Â  order: -1; /* Mover la barra lateral hacia arriba (opcional: mejor para UX mÃ³vil) */
Â  }
Â  .sidebar h3 {
Â  Â  margin: 10px 15px;
Â  Â  border-bottom: none;
Â  Â  padding-bottom: 0;
Â  Â  font-size: 16px;
Â  Â  text-align: center;
Â  Â  display: none; /* Ocultar el tÃ­tulo 'MenÃº del Presentador' para ahorrar espacio */
Â  }
Â  .sidebar ul {
Â  Â  display: flex; /* Mostrar como una barra horizontal deslizante si es necesario */
Â  Â  overflow-x: auto;
Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  padding: 0 5px; /* PequeÃ±o padding para los bordes */
Â  }
Â  .sidebar li { flex-shrink: 0; }
Â  .sidebar li a {
Â  Â  padding: 8px 15px; /* MÃ¡s compacto */
Â  Â  font-size: 14px;
Â  Â  border-left: none; /* Quitar borde izquierdo en mÃ³vil */
Â  Â  border-radius: 10px; /* Borde suave */
Â  Â  margin: 0 5px;
Â  Â  text-align: center;
Â  }
Â  .sidebar li a.active {
Â  Â  border-left: none;
Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  }
Â  .sidebar li a span { display: none; } /* Ocultar el texto para mostrar solo el Ã­cono (opcional) */
Â  .sidebar li a.active span { display: inline-block; } /* Mostrar solo el icono activo */
Â  .sidebar li a.active:after { content: attr(data-icon); } /* Si quieres mostrar solo el texto activo, puedes hacer esto */
Â  .sidebar li a:before { content: attr(data-icon); margin-right: 5px; } /* Mantenemos el Ã­cono, si existe. */
Â  /* Ajuste rÃ¡pido para mostrar texto y Ã­cono en mÃ³vil */
Â  .sidebar li a span { display: inline; }


Â  /* Dashboard Grid */
Â  .dashboard-grid {
Â  Â  grid-template-columns: 1fr; /* Una columna en mÃ³vil */
Â  }

Â  /* Live Session / Questions Builder */
Â  .presentation-controls {
Â  Â  flex-direction: column;
Â  Â  align-items: stretch;
Â  }
Â  .live-reactions {
Â  Â  justify-content: space-around;
Â  Â  flex-wrap: wrap;
Â  Â  margin-bottom: 15px;
Â  }
Â  .timer-section {
Â  Â  justify-content: center;
Â  Â  flex-wrap: wrap;
Â  }
Â  .timer-section input { width: 40px !important; }
Â  .timer-section button { margin-top: 10px; }
Â  .timer-display { margin-top: 10px; margin-left: 0; }
Â Â 
Â  .question-type-selector {
Â  Â  flex-wrap: wrap;
Â  }
Â  .question-type-selector button { flex-grow: 1; }
Â  .add-option { width: 100%; }
Â Â 
Â  /* Controles de PresentaciÃ³n */
Â  #presenter-live-session-content .content-card div[style*="flex"] {
Â  Â  flex-direction: column;
Â  }
Â  #presenter-live-session-content .content-card button {
Â  Â  width: 100%;
Â  Â  margin-top: 8px;
Â  }
Â  /* Interfaz de Espectador */
Â  .spectator-interface {
Â  Â  margin: 20px auto;
Â  Â  padding: 20px;
Â  }
Â  .spectator-interactions button {
Â  Â  width: 50px;
Â  Â  height: 50px;
Â  Â  font-size: 24px;
Â  }
Â Â 
}
/* --- FIN: MEJORAS PARA MÃ“VIL (max-width: 640px) --- */


/* --- FIN: tu CSS EXACTO (no modificado) --- */


/* --- INICIO: CSS EXTENDIDO Y PROFESIONAL PARA PANTALLAS INTERNAS --- */

.app-shell {
Â  position: relative;
Â  z-index: 3;
Â  width: 100%;
Â  max-width: 1200px;
Â  margin: 0 auto;
Â  padding: 0 72px 80px 72px; /* Espacio para que el footer no quede pegado */
}
.container-panel { margin-top: 24px; }
.hidden { display: none !important; }
.visually-hidden { position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px, 1px, 1px, 1px); white-space:nowrap; }

/* Tarjetas y Contenedores */
.card, .spectator-input-card, .content-card {
Â  background-color: white;
Â  padding: var(--card-padding);
Â  border-radius: var(--radius);
Â  box-shadow: 0 6px 15px rgba(18,60,50,0.08);
Â  margin-bottom: 20px;
}
.content-card { padding: 25px 30px; }

/* Formularios de AutenticaciÃ³n (Login/Register) */
#presenter-login {
Â  display: flex;
Â  justify-content: center;
Â  padding-top: 50px;
Â  min-height: 50vh;
}
.auth-form {
Â  max-width: 450px;
Â  width: 100%;
Â  padding: 40px;
Â  text-align: center;
}
.auth-form h2 {
Â  font-size: 32px;
Â  font-weight: 800;
Â  margin-top: 0;
Â  margin-bottom: 25px;
}
.auth-form label {
Â  display: block;
Â  text-align: left;
Â  margin-top: 15px;
Â  margin-bottom: 5px;
Â  font-weight: 600;
Â  color: var(--muted);
Â  font-size: 14px;
}
.auth-form input[type="email"],
.auth-form input[type="password"],
.auth-form input[type="text"] {
Â  width: 100%;
Â  padding: 12px 15px;
Â  border: 1px solid #ddd;
Â  border-radius: 8px;
Â  font-size: 16px;
Â  color: var(--text-dark);
}
.auth-form button[type="submit"] {
Â  width: 100%;
Â  padding: 15px;
Â  background-color: var(--green);
Â  color: white;
Â  font-weight: 700;
Â  border: none;
Â  border-radius: 12px;
Â  cursor: pointer;
Â  font-size: 18px;
Â  box-shadow: 0 4px 10px rgba(136, 193, 178, 0.5);
Â  transition: background-color 0.2s, transform 0.2s;
}
.auth-form button[type="submit"]:hover {
Â  background-color: #6dafa0;
Â  transform: translateY(-1px);
}
.switch-form {
Â  margin-top: 25px;
Â  font-size: 14px;
Â  color: var(--muted);
}
.switch-form a {
Â  color: var(--text-dark);
Â  font-weight: 600;
Â  text-decoration: none;
}


/* Dashboard Layout */
.presenter-dashboard {
Â  display: flex; /* Mantiene la barra lateral y el contenido uno al lado del otro */
Â  gap: 30px;
Â  width: 100%;Â 
Â  max-width: 1200px;
}

.sidebar {
Â  width: 250px;
Â  flex-shrink: 0;
Â  background-color: white;
Â  border-radius: var(--radius);
Â  padding: 25px 0;
Â  box-shadow: 0 6px 15px rgba(18,60,50,0.08);
Â  height: fit-content;
}
.sidebar h3 {
Â  margin: 0 25px 20px 25px;
Â  padding-bottom: 10px;
Â  border-bottom: 1px solid #f0f0f0;
Â  color: var(--muted);
Â  font-size: 18px;
}
.sidebar ul {
Â  list-style: none;
Â  padding: 0;
Â  margin: 0;
}
.sidebar li a {
Â  display: flex;
Â  align-items: center;
Â  gap: 10px;
Â  padding: 12px 25px;
Â  text-decoration: none;
Â  color: var(--text-dark);
Â  font-weight: 600;
Â  transition: background-color 0.1s, color 0.1s;
Â  border-left: 4px solid transparent;
}
.sidebar li a:hover {
Â  background-color: var(--bg-top);
Â  color: var(--text-dark);
}
.sidebar li a.active {
Â  background-color: var(--green);
Â  color: white;
Â  border-left: 4px solid var(--text-dark);
}
.sidebar li a.active .sidebar-icon {
Â  filter: brightness(0) invert(1);
}

.main-content {
Â  flex-grow: 1;
}

/* Dashboard Grid (Overview) */
.dashboard-grid {
Â  display: grid;
Â  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
Â  gap: 20px;
Â  margin-top: 20px;
}
.dashboard-card {
Â  background-color: var(--bg-top);
Â  padding: 25px;
Â  border-radius: var(--radius);
Â  box-shadow: inset 0 0 0 2px rgba(136, 193, 178, 0.3);
Â  transition: transform 0.3s;
}
.dashboard-card:hover {
Â  transform: translateY(-3px);
Â  box-shadow: 0 4px 10px rgba(18,60,50,0.1), inset 0 0 0 2px var(--green);
}
.dashboard-card h4 {
Â  margin-top: 0;
Â  font-size: 20px;
Â  display: flex;
Â  align-items: center;
Â  gap: 8px;
Â  color: var(--muted);
}
.dashboard-card p {
Â  color: var(--muted);
Â  line-height: 1.5;
Â  font-size: 15px;
}
.dashboard-card button {
Â  background-color: var(--yellow);
Â  color: var(--text-dark);
Â  font-weight: 700;
Â  border: none;
Â  padding: 10px 15px;
Â  border-radius: 8px;
Â  cursor: pointer;
Â  transition: opacity 0.2s;
Â  margin-top: 10px;
}
.dashboard-card button:hover { opacity: 0.8; }

/* QR Code */
.qr-code-section {
Â  text-align: center;
Â  padding: 10px 0;
}
.qr-code-section p {
Â  font-weight: 600;
Â  margin-bottom: 10px;
}
.session-id {
Â  font-size: 20px;
Â  font-weight: 800;
Â  color: var(--text-dark);
Â  margin-bottom: 15px;
Â  background: var(--bg-top);
Â  padding: 5px 10px;
Â  border-radius: 8px;
Â  display: inline-block;
}


/* Live Session Styles */
.presenter-live-view {
Â  /* Contenedor principal para organizar controles y vista */
}
.presentation-controls {
Â  display: flex;
Â  justify-content: space-between;
Â  align-items: center;
Â  padding: 15px 0;
Â  margin-bottom: 20px;
Â  border-bottom: 1px solid #eee;
}
.live-reactions {
Â  display: flex;
Â  gap: 15px;
}
.reaction-badge {
Â  display: flex;
Â  align-items: center;
Â  gap: 5px;
Â  font-size: 20px;
Â  background: #f0f0f0;
Â  padding: 8px 12px;
Â  border-radius: 12px;
Â  font-weight: 700;
}
.reaction-badge .count {
Â  font-size: 16px;
Â  color: var(--muted);
}

.timer-section {
Â  display: flex;
Â  align-items: center;
Â  gap: 5px;
Â  font-weight: 600;
}
.timer-section input {
Â  padding: 8px 0;
Â  border: 1px solid #ddd;
Â  border-radius: 6px;
Â  text-align: center;
Â  font-size: 16px;
}
.timer-section button {
Â  background-color: var(--green);
Â  color: white;
Â  border: none;
Â  padding: 8px 12px;
Â  border-radius: 8px;
Â  cursor: pointer;
Â  transition: opacity 0.2s;
}
.timer-section button:hover { opacity: 0.8; }
.timer-display {
Â  font-size: 22px;
Â  font-weight: 800;
Â  color: #d9534f; /* Rojo para el contador */
Â  margin-left: 10px;
Â  padding: 5px 10px;
Â  border: 2px solid #d9534f;
Â  border-radius: 8px;
}

/* Question Builder */
.question-builder {
Â  background-color: white;
Â  padding: 30px;
Â  border-radius: var(--radius);
Â  box-shadow: 0 6px 15px rgba(18,60,50,0.08);
Â  margin-bottom: 20px;
}
.question-type-selector {
Â  display: flex;
Â  gap: 10px;
Â  margin-bottom: 20px;
}
.question-type-selector button {
Â  background: #f0f0f0;
Â  color: var(--text-dark);
Â  border: none;
Â  padding: 10px 15px;
Â  border-radius: 12px;
Â  cursor: pointer;
Â  font-weight: 600;
Â  transition: background 0.2s;
}
.question-type-selector button:hover { background: #e0e0e0; }
.question-type-selector button.active {
Â  background: var(--text-dark);
Â  color: white;
}
.question-form input[type="text"]#question-title {
Â  width: 100%;
Â  padding: 15px;
Â  margin-bottom: 15px;
Â  border: 2px solid var(--yellow);
Â  border-radius: 12px;
Â  font-size: 18px;
}
.options-container {
Â  display: flex;
Â  flex-direction: column;
Â  gap: 10px;
}
.option-input {
Â  display: flex;
Â  gap: 10px;
Â  align-items: center;
}
.option-input input {
Â  flex-grow: 1;
Â  padding: 10px;
Â  border: 1px solid #ddd;
Â  border-radius: 8px;
Â  font-size: 16px;
}
.add-option {
Â  background: var(--green);
Â  color: white;
Â  border: none;
Â  padding: 10px 15px;
Â  border-radius: 8px;
Â  cursor: pointer;
Â  margin-top: 10px;
Â  width: 200px;
Â  font-weight: 600;
}
.option-button {
Â  background: var(--yellow);
Â  color: var(--text-dark);
Â  font-weight: 800;
Â  padding: 15px;
Â  border: none;
Â  border-radius: 12px;
Â  cursor: pointer;
Â  font-size: 18px;
Â  display: flex;
Â  align-items: center;
Â  justify-content: center;
Â  gap: 10px;
}

/* Spectator Join/Interface */
.spectator-input-card {
Â  max-width: 450px;
Â  margin: 50px auto;
Â  padding: 40px;
Â  text-align: center;
}
.spectator-input-card h2 {
Â  font-size: 28px;
Â  margin-top: 0;
Â  margin-bottom: 10px;
}
.spectator-input-card p {
Â  color: var(--muted);
Â  margin-bottom: 25px;
}
.spectator-input-card label {
Â  display: block;
Â  text-align: left;
Â  margin-top: 15px;
Â  margin-bottom: 5px;
Â  font-weight: 600;
Â  color: var(--muted);
Â  font-size: 14px;
}
.spectator-input-card input {
Â  width: 100%;
Â  padding: 12px 15px;
Â  border: 1px solid #ddd;
Â  border-radius: 8px;
Â  font-size: 16px;
Â  color: var(--text-dark);
}
.spectator-input-card button {
Â  width: 100%;
Â  padding: 15px;
Â  background-color: var(--yellow);
Â  color: var(--text-dark);
Â  font-weight: 700;
Â  border: none;
Â  border-radius: 12px;
Â  cursor: pointer;
Â  font-size: 18px;
Â  box-shadow: 0 4px 10px rgba(245, 207, 102, 0.5);
Â  margin-top: 20px;
Â  transition: background-color 0.2s, transform 0.2s;
}
.spectator-input-card button:hover {
Â  background-color: #f0c85a;
Â  transform: translateY(-1px);
}

.spectator-interface {
Â  max-width: 900px;
Â  margin: 30px auto;
Â  padding: 30px;
Â  background-color: white;
Â  border-radius: var(--radius);
Â  box-shadow: 0 6px 15px rgba(18,60,50,0.08);
Â  text-align: center;
}
.spectator-presentation-area {
Â  background-color: #f5f5f5;
Â  padding: 20px;
Â  border-radius: 12px;
Â  margin-top: 20px;
Â  min-height: 400px;
Â  display: flex;
Â  flex-direction: column;
Â  justify-content: center;
}
.spectator-presentation-area h3 { color: var(--text-dark); }
.slide-counter {
Â  font-weight: 600;
Â  color: var(--muted);
Â  margin-top: 15px;
}
.spectator-interactions {
Â  display: flex;
Â  justify-content: center;
Â  gap: 20px;
Â  margin-top: 30px;
}
.spectator-interactions button {
Â  background: var(--bg-top);
Â  border: 2px solid var(--green);
Â  border-radius: 50%;
Â  width: 60px;
Â  height: 60px;
Â  font-size: 28px;
Â  cursor: pointer;
Â  transition: transform 0.1s, box-shadow 0.1s;
}
.spectator-interactions button:active {
Â  transform: scale(0.95);
Â  box-shadow: 0 0 0 5px rgba(136, 193, 178, 0.5);
}
/* --- FIN: CSS EXTENDIDO Y PROFESIONAL PARA PANTALLAS INTERNAS --- */
Â  </style>
</head>
<body>
Â  <header class="site-header">
Â  Â  <div class="brand">
Â  Â  Â  <img src="logo.png" alt="AulaPudu logo" class="logo" onerror="this.style.display='none'">
Â  Â  Â  <h1>AulaPudu</h1>
Â  Â  </div>
Â  Â  <nav class="nav">
Â  Â  Â  <a href="#" onclick="showPage('landing')">Inicio</a>
Â  Â  Â  <span class="sep">|</span>
Â  Â  Â  <a href="#" onclick="showPage('presenter-login')">Iniciar</a>
Â  Â  Â  <span class="sep">|</span>
Â  Â  Â  <a href="#" onclick="showPage('spectator-join')">Unirse</a>
Â  Â  </nav>
Â  </header>

Â  <main>
Â  Â  <section id="landing" class="hero" aria-label="Hero principal" style="display:block;">
Â  Â  Â  <img src="pudu-large.png" alt="Pudu illustration" class="pudu-big" aria-hidden="true" onerror="this.style.display='none'">
Â  Â  Â  <div class="hero-content" role="region" aria-label="Hero">
Â  Â  Â  Â  <p class="eyebrow">PLATAFORMA INTERACTIVA PARA APRENDIZAJE</p>
Â  Â  Â  Â  <h2 class="headline">Aprende sin fronteras</h2>
Â  Â  Â  Â  <p class="subhead">Conecta, aprende y enseÃ±a en un entorno digital interactivo, sin lÃ­mites.</p>

Â  Â  Â  Â  <div class="cta-list">
Â  Â  Â  Â  Â  <a class="cta cta-yellow" href="#" role="button" onclick="showPage('spectator-join')">
Â  Â  Â  Â  Â  Â  <img src="pudu-icon-grad.png" alt="" class="cta-icon" onerror="this.style.display='none'">
Â  Â  Â  Â  Â  Â  <span>Entrar como espectador</span>
Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  <a class="cta cta-green" href="#" role="button" onclick="showPage('presenter-login')">
Â  Â  Â  Â  Â  Â  <img src="pudu-icon.png" alt="" class="cta-icon" onerror="this.style.display='none'">
Â  Â  Â  Â  Â  Â  <span>Entrar como presentador</span>
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </section>
Â  </main>

Â  <div id="app" class="app-shell container-panel" style="display:none;">

Â  Â  <div id="presenter-login" style="display:none;">
Â  Â  Â  <div class="card auth-form">
Â  Â  Â  Â  <h2 id="auth-title">Inicio de Presentador</h2>
Â  Â  Â  Â  <form id="login-form" onsubmit="event.preventDefault(); authenticateUser();">
Â  Â  Â  Â  Â  <label for="email">Correo electrÃ³nico:</label>
Â  Â  Â  Â  Â  <input type="email" id="email" name="email" value="presentador@aulapudu.com" required>
Â  Â  Â  Â  Â  <label for="password">ContraseÃ±a:</label>
Â  Â  Â  Â  Â  <input type="password" id="password" name="password" value="123456" required>
Â  Â  Â  Â  Â  <button type="submit" style="margin-top:30px;">Iniciar SesiÃ³n</button>
Â  Â  Â  Â  Â  <div class="switch-form">
Â  Â  Â  Â  Â  Â  Â¿No tienes una cuenta? <a href="#" onclick="toggleAuthForm()">RegÃ­strate aquÃ­</a>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  Â  Â  <form id="register-form" style="display:none;" onsubmit="event.preventDefault(); registerUser();">
Â  Â  Â  Â  Â  <label for="reg-name">Nombre completo:</label>
Â  Â  Â  Â  Â  <input type="text" id="reg-name" name="reg-name" required>
Â  Â  Â  Â  Â  <label for="reg-email">Correo electrÃ³nico:</label>
Â  Â  Â  Â  Â  <input type="email" id="reg-email" name="reg-email" required>
Â  Â  Â  Â  Â  <label for="reg-password">ContraseÃ±a:</label>
Â  Â  Â  Â  Â  <input type="password" id="reg-password" name="reg-password" required>
Â  Â  Â  Â  Â  <label for="confirm-password">Confirmar ContraseÃ±a:</label>
Â  Â  Â  Â  Â  <input type="password" id="confirm-password" name="confirm-password" required>
Â  Â  Â  Â  Â  <button type="submit" style="margin-top:30px;">Registrarse</button>
Â  Â  Â  Â  Â  <div class="switch-form">
Â  Â  Â  Â  Â  Â  Â¿Ya tienes una cuenta? <a href="#" onclick="toggleAuthForm()">Inicia sesiÃ³n aquÃ­</a>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="presenter-dashboard" class="presenter-dashboard" style="display:none; margin-top:30px;">
Â  Â  Â  <div class="sidebar">
Â  Â  Â  Â  <h3>MenÃº del Presentador</h3>
Â  Â  Â  Â  <ul>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ“Š" class="active" onclick="showPresenterContent('overview')"><span class="sidebar-icon">ğŸ“Š</span> Resumen</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ“" onclick="showPresenterContent('presentations')"><span class="sidebar-icon">ğŸ“</span> Presentaciones</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ”´" onclick="showPresenterContent('live-session')"><span class="sidebar-icon">ğŸ”´</span> SesiÃ³n en Vivo</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="â“" onclick="showPresenterContent('questions')"><span class="sidebar-icon">â“</span> Preguntas</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ‘¥" onclick="showPresenterContent('spectator-management')"><span class="sidebar-icon">ğŸ‘¥</span> GestiÃ³n de Espectadores</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ“š" onclick="showPresenterContent('course-materials')"><span class="sidebar-icon">ğŸ“š</span> Materiales</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸ“ˆ" onclick="showPresenterContent('reports')"><span class="sidebar-icon">ğŸ“ˆ</span> Informes</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="âš™ï¸" onclick="alert('Â¡PÃ¡gina de configuraciÃ³n prÃ³ximamente!')"><span class="sidebar-icon">âš™ï¸</span> ConfiguraciÃ³n</a></li>
Â  Â  Â  Â  Â  <li><a href="#" data-icon="ğŸšª" onclick="logout()"><span class="sidebar-icon">ğŸšª</span> Cerrar SesiÃ³n</a></li>
Â  Â  Â  Â  </ul>
Â  Â  Â  </div>

Â  Â  Â  <div class="main-content">
Â  Â  Â  Â  <div id="presenter-overview-content" style="display: none;">
Â  Â  Â  Â  Â  <h2>Resumen del Dashboard</h2>
Â  Â  Â  Â  Â  <div class="dashboard-grid">
Â  Â  Â  Â  Â  Â  <div class="dashboard-card fade-in">
Â  Â  Â  Â  Â  Â  Â  <h4><span class="sidebar-icon">ğŸ“Š</span> PresentaciÃ³n Actual</h4>
Â  Â  Â  Â  Â  Â  Â  <p id="current-presentation-text">No hay presentaciÃ³n activa. Inicia una nueva o continÃºa desde tu biblioteca.</p>
Â  Â  Â  Â  Â  Â  Â  <button onclick="showPresenterContent('presentations')">Gestionar Presentaciones</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="dashboard-card fade-in">
Â  Â  Â  Â  Â  Â  Â  <h4><span class="sidebar-icon">ğŸ”´</span> Estado de SesiÃ³n en Vivo</h4>
Â  Â  Â  Â  Â  Â  Â  <div class="qr-code-section">
Â  Â  Â  Â  Â  Â  Â  Â  <p>Escanear para unirse:</p>
Â  Â  Â  Â  Â  Â  Â  Â  <img id="qr-code-img" src="" alt="CÃ³digo QR" style="width:180px;height:180px;border-radius:12px; display:none;" onerror="this.style.display='none'">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="session-id" id="session-id-display" style="margin-top:10px;">--</div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="generateNewSession()">Generar Nuevo CÃ³digo QR</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="dashboard-card fade-in">
Â  Â  Â  Â  Â  Â  Â  <h4><span class="sidebar-icon">ğŸ“ˆ</span> Actividad Reciente</h4>
Â  Â  Â  Â  Â  Â  Â  <p>5 nuevos espectadores se unieron a la presentaciÃ³n 'IntroducciÃ³n a la IA'.</p>
Â  Â  Â  Â  Â  Â  Â  <p>Resultados del quiz exportados para 'RevisiÃ³n del MÃ³dulo 1'.</p>
Â  Â  Â  Â  Â  Â  Â  <button onclick="showPresenterContent('reports')">Ver Toda la Actividad</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-presentations-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>Mis Presentaciones</h2>
Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“¤</span> Subir Nueva PresentaciÃ³n</h3>
Â  Â  Â  Â  Â  Â  <p>Formatos soportados: PDF, PowerPoint (PPT/PPTX)</p>
Â  Â  Â  Â  Â  Â  <input type="file" id="presentation-upload" accept=".pdf,.ppt,.pptx" style="margin-bottom: 15px;">
Â  Â  Â  Â  Â  Â  <button onclick="uploadPresentation()" id="upload-presentation-btn">Subir PresentaciÃ³n</button>
Â  Â  Â  Â  Â  Â  <div id="upload-presentation-status" style="margin-top: 10px;"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“</span> Presentaciones Disponibles</h3>
Â  Â  Â  Â  Â  Â  <ul id="presentations-list" style="list-style:none;padding:0;margin:0;">
Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-live-session-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>Control de SesiÃ³n en Vivo</h2>
Â  Â  Â  Â  Â  <div class="presenter-live-view">
Â  Â  Â  Â  Â  Â  <div class="presentation-controls">
Â  Â  Â  Â  Â  Â  Â  <div class="live-reactions">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="reaction-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>â¤ï¸</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="count" id="count-love">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="reaction-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ‘</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="count" id="count-clap">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="reaction-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>â“</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="count" id="count-question">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="reaction-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ‘</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="count" id="count-thumbsup">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="reaction-badge">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ‘</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="count" id="count-thumbsdown">0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="timer-section">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="timer-hours" min="0" max="99" value="0" placeholder="HH" style="width: 50px; text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  <span>:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="timer-minutes" min="0" max="59" value="0" placeholder="MM" style="width: 50px; text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  <span>:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="timer-seconds" min="0" max="59" value="0" placeholder="SS" style="width: 50px; text-align: center;">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="startTimerWithInput()">Iniciar Timer</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="resetTimerAndReactions()">Reiniciar</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="timer-display" id="timer-display">00:00:00</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ”´</span> Presentando Actualmente: <span id="current-presentation-title">--</span></h3>
Â  Â  Â  Â  Â  Â  Â  <p>Diapositiva Actual: <span id="current-slide">1</span>/<span id="total-slides">1</span></p>

Â  Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:10px;margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="prevSlide()">Diapositiva Anterior</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="nextSlide()">Siguiente Diapositiva</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button style="background-color: var(--yellow); color: var(--text-dark);" onclick="endSession()">Finalizar SesiÃ³n</button>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div id="pdf-viewer-container" style="width:100%; height:500px; margin-top:20px; border:1px solid #ddd; border-radius:8px; overflow:auto;">
Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="pdf-canvas" style="display:block;margin:0 auto;"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="current-slide-content" style="padding:20px; text-align:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>Diapositiva 1</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Carga una presentaciÃ³n PDF para previsualizar aquÃ­.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="dashboard-grid" style="margin-top:16px;">
Â  Â  Â  Â  Â  Â  Â  <div class="dashboard-card fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  <h4><span class="sidebar-icon">ğŸ“Š</span> Encuestas y Quizzes</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p>Crea encuestas interactivas y quizzes para tu audiencia.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showPresenterContent('questions')">Crear Nueva Pregunta</button>
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="dashboard-card fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  <h4><span class="sidebar-icon">ğŸ‘¥</span> Espectadores Conectados</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="connected-spectators">0 espectadores activos</p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="showPresenterContent('spectator-management')">Gestionar Espectadores</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-questions-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>Sistema de Preguntas y Formularios</h2>

Â  Â  Â  Â  Â  <div class="question-builder fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">â“</span> Crear Nueva Pregunta</h3>

Â  Â  Â  Â  Â  Â  <div class="question-type-selector">
Â  Â  Â  Â  Â  Â  Â  <button class="active" onclick="setQuestionType('multiple-choice', event)">OpciÃ³n MÃºltiple</button>
Â  Â  Â  Â  Â  Â  Â  <button onclick="setQuestionType('true-false', event)">Verdadero/Falso</button>
Â  Â  Â  Â  Â  Â  Â  <button onclick="setQuestionType('open-ended', event)">Respuesta Abierta</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="question-form">
Â  Â  Â  Â  Â  Â  Â  <input type="text" id="question-title" placeholder="Escribe tu pregunta aquÃ­">
Â  Â  Â  Â  Â  Â  Â  <div id="options-container" class="options-container">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="option-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="OpciÃ³n 1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="red" onclick="removeOption(this)">âœ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="option-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" placeholder="OpciÃ³n 2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="red" onclick="removeOption(this)">âœ•</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <button class="add-option" onclick="addOption()">+ AÃ±adir OpciÃ³n</button>
Â  Â  Â  Â  Â  Â  Â  <button class="option-button" onclick="saveQuestion()" style="width:100%; margin-top:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="sidebar-icon">ğŸ’¾</span> Guardar Pregunta
Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“‹</span> Preguntas Guardadas</h3>
Â  Â  Â  Â  Â  Â  <ul id="saved-questions" style="list-style:none;padding:0;margin:0;">
Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-spectator-management-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>GestiÃ³n de Espectadores</h2>
Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ‘¥</span> Espectadores Conectados (<span id="active-spectators">0</span> Activos)</h3>
Â  Â  Â  Â  Â  Â  <ul id="spectators-list" style="list-style:none;padding:0;margin:0;">
Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  <button style="margin-top:15px; opacity:0.5; cursor:not-allowed;" disabled>Agrupar Espectadores Aleatoriamente</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“</span> Archivos de Espectadores</h3>
Â  Â  Â  Â  Â  Â  <p id="spectator-files-status">No hay nuevos archivos subidos por espectadores.</p>
Â  Â  Â  Â  Â  Â  <button onclick="loadSpectatorFiles()">Ver Todos los Archivos</button>
Â  Â  Â  Â  Â  Â  <div id="spectator-files-list" style="margin-top:15px;"></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-course-materials-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>Materiales del Curso</h2>
Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“¤</span> Subir Nuevo Material</h3>
Â  Â  Â  Â  Â  Â  <p>Formatos soportados: PDF, DOCX, PPTX, imÃ¡genes</p>
Â  Â  Â  Â  Â  Â  <input type="file" id="material-upload" style="margin-bottom:15px;">
Â  Â  Â  Â  Â  Â  <button onclick="uploadMaterial()" id="upload-material-btn">Subir Material</button>
Â  Â  Â  Â  Â  Â  <div id="upload-material-status" style="margin-top:10px;"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“š</span> Material de Estudio Disponible</h3>
Â  Â  Â  Â  Â  Â  <ul id="materials-list" style="list-style:none;padding:0;margin:0;">
Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="presenter-reports-content" style="display:none;">
Â  Â  Â  Â  Â  <h2>Informes y AnalÃ­ticas</h2>
Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ“</span> Resultados de Quiz: 'Intro a IA'</h3>
Â  Â  Â  Â  Â  Â  <p>Resumen de respuestas y datos de participantes.</p>
Â  Â  Â  Â  Â  Â  <button onclick="generateHTMLReport()">Generar Reporte HTML</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">âœ…</span> Reporte de Asistencia: Ãšltima SesiÃ³n</h3>
Â  Â  Â  Â  Â  Â  <p>Registros detallados de asistencia incluyendo tiempos de conexiÃ³n.</p>
Â  Â  Â  Â  Â  Â  <button onclick="viewAttendance()">Ver Asistencia</button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="content-card fade-in" id="attendance-report" style="display:none;">
Â  Â  Â  Â  Â  Â  <h3><span class="sidebar-icon">ğŸ‘¥</span> Lista de Asistencia</h3>
Â  Â  Â  Â  Â  Â  <div id="attendance-list"></div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div id="html-report-container" style="display:none;"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="spectator-join" style="display:none;">
Â  Â  Â  <div class="spectator-input-card card">
Â  Â  Â  Â  <h2>Unirse a una PresentaciÃ³n</h2>
Â  Â  Â  Â  <p>Escanee el cÃ³digo QR o ingrese el ID de sesiÃ³n para unirse.</p>
Â  Â  Â  Â  <label for="session-id-input">ID de SesiÃ³n:</label>
Â  Â  Â  Â  <input type="text" id="session-id-input" placeholder="ej. AULAPUDU-12345" required>
Â  Â  Â  Â  <label for="spectator-name">Tu Nombre:</label>
Â  Â  Â  Â  <input type="text" id="spectator-name" placeholder="Ingresa tu nombre" required>
Â  Â  Â  Â  <button onclick="event.preventDefault(); joinSession()">Unirse a la SesiÃ³n</button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="spectator-interface" style="display:none;">
Â  Â  Â  <div class="spectator-interface">
Â  Â  Â  Â  <h2>PresentaciÃ³n en Vivo: <span id="spectator-presentation-title">IntroducciÃ³n a la Ciencia de Datos</span></h2>
Â  Â  Â  Â  <div class="spectator-presentation-area">
Â  Â  Â  Â  Â  <div class="slide-container">
Â  Â  Â  Â  Â  Â  <div id="spectator-current-slide-content">
Â  Â  Â  Â  Â  Â  Â  <h3>Esperando al Presentador</h3>
Â  Â  Â  Â  Â  Â  Â  <p>La presentaciÃ³n comenzarÃ¡ pronto o ya estÃ¡ en curso...</p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="slide-nav">
Â  Â  Â  Â  Â  Â  Â  <div class="slide-counter">Diapositiva <span id="spectator-slide-number">--</span> de <span id="spectator-total-slides">--</span></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="spectator-interactions">
Â  Â  Â  Â  Â  <button title="Â¡Me encanta!" onclick="sendReaction('love')">â¤ï¸</button>
Â  Â  Â  Â  Â  <button title="Â¡Aplaudir!" onclick="sendReaction('clap')">ğŸ‘</button>
Â  Â  Â  Â  Â  <button title="Pregunta" onclick="sendReaction('question')">â“</button>
Â  Â  Â  Â  Â  <button title="Pulgar Arriba" onclick="sendReaction('thumbsup')">ğŸ‘</button>
Â  Â  Â  Â  Â  <button title="Pulgar Abajo" onclick="sendReaction('thumbsdown')">ğŸ‘</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="spectator-input-card card" style="margin-top:30px;">
Â  Â  Â  Â  Â  <h3>Contenido Interactivo</h3>
Â  Â  Â  Â  Â  <p>Participa en encuestas, responde preguntas o sube archivos.</p>
Â  Â  Â  Â  Â  <button onclick="answerQuestion()">Responder Pregunta</button>
Â  Â  Â  Â  Â  <button style="margin-top:10px;" onclick="uploadFileAsSpectator()">Subir Archivo al Presentador</button>
Â  Â  Â  Â  Â  <button style="margin-top:10px;">Descargar Material de Estudio</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  </div> <footer class="site-footer" aria-hidden="true" style="padding:40px 80px 80px 80px;"></footer>

Â  <script>
Â  Â  /************************************************************************
Â  Â  Â * CONFIG
Â  Â  Â ************************************************************************/
Â  Â  const SUPABASE_URL = "https://kcmxanjadpriphneygtx.supabase.co";Â 
Â  Â  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjbXhhbmphZHByaXBobmV5Z3R4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcyOTU0ODMsImV4cCI6MjA3Mjg3MTQ4M30.J9tJn1pjdUHlFfTPpqWslWLs16CTs22IZiEgCjOMbGY";Â 
Â  Â  const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

Â  Â  /************************************************************************
Â  Â  Â * ESTADO LOCAL Y SIMULACIÃ“N DE BD
Â  Â  Â ************************************************************************/
Â  Â  let currentSessionCode = null;Â 
Â  Â  let currentUser = null;
Â  Â  let currentPresentation = null;
Â  Â  let currentSlide = 1;Â 
Â  Â  let totalSlides = 10;Â 
Â  Â  let questionType = 'multiple-choice';
Â  Â  let reactionCounts = { love:0, clap:0, question:0, thumbsup:0, thumbsdown:0 };
Â  Â  let timerInterval = null, timerSeconds = 0;
Â  Â  let pdfDoc = null;
Â  Â  let currentFileUrl = null;
Â  Â  let fileType = null;
Â  Â  let rt = { chan: null, sessionId: null, presenceKey: null, liveSpectators: {} };
Â  Â  let isPresenter = false;
Â  Â Â 
Â  Â  // Almacenamiento local para archivos subidos por el presentador (simulaciÃ³n de Supabase Storage)
Â  Â  let uploadedFiles = {
Â  Â  Â  presentations: [],
Â  Â  Â  materials: []
Â  Â  };
Â  Â  let savedQuestions = [];

Â  Â  /************************************************************************
Â  Â  Â * NAVEGACIÃ“N VISTAS
Â  Â  Â ************************************************************************/
Â  Â  function showPage(pageId){
Â  Â  Â  const ids = ['presenter-login','presenter-dashboard','spectator-join','spectator-interface'];
Â  Â  Â  ids.forEach(id => {
Â  Â  Â  Â  const el = document.getElementById(id);
Â  Â  Â  Â  if (el) el.style.display = 'none';
Â  Â  Â  });

Â  Â  Â  const landingEl = document.getElementById('landing');
Â  Â  Â  const appShellEl = document.getElementById('app');

Â  Â  Â  if (pageId === 'landing'){
Â  Â  Â  Â  if (landingEl) landingEl.style.display = 'flex';
Â  Â  Â  Â  if (appShellEl) appShellEl.style.display = 'none';
Â  Â  Â  Â  isPresenter = false;
Â  Â  Â  Â  cleanupRealtime();
Â  Â  Â  } else {
Â  Â  Â  Â  if (landingEl) landingEl.style.display = 'none';
Â  Â  Â  Â  if (appShellEl) appShellEl.style.display = 'block';

Â  Â  Â  Â  if (pageId === 'presenter-dashboard' && !currentUser) {
Â  Â  Â  Â  Â  pageId = 'presenter-login';
Â  Â  Â  Â  }

Â  Â  Â  Â  const el = document.getElementById(pageId);
Â  Â  Â  Â  if (el) el.style.display = 'block';
Â  Â  Â  Â  if (pageId === 'presenter-dashboard'){
Â  Â  Â  Â  Â  Â  isPresenter = true;
Â  Â  Â  Â  Â  Â  // Cargar listas dinÃ¡micas al entrar al dashboard
Â  Â  Â  Â  Â  Â  loadSavedQuestions();
Â  Â  Â  Â  Â  Â  loadPresentationsListUI();
Â  Â  Â  Â  Â  Â  loadMaterialsListUI();
Â  Â  Â  Â  Â  Â  // Mostrar la pÃ¡gina de resumen por defecto
Â  Â  Â  Â  Â  Â  showPresenterContent('overview');
Â  Â  Â  Â  Â  Â  if(currentSessionCode) generateQrCode(currentSessionCode);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  isPresenter = false;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  }

Â  Â  function toggleAuthForm(){
Â  Â  Â  const loginForm = document.getElementById('login-form');
Â  Â  Â  const registerForm = document.getElementById('register-form');
Â  Â  Â  const authTitle = document.getElementById('auth-title');
Â  Â  Â  const isLogin = loginForm.style.display !== 'none';
Â  Â  Â  loginForm.style.display = isLogin ? 'none' : 'block';
Â  Â  Â  registerForm.style.display = isLogin ? 'block' : 'none';
Â  Â  Â  authTitle.innerText = isLogin ? 'Registro de Presentador' : 'Inicio de Presentador';
Â  Â  }

Â  Â  function showPresenterContent(contentId){
Â  Â  Â  const mainContentDiv = document.querySelector('#presenter-dashboard .main-content');
Â  Â  Â  if (!mainContentDiv) return;
Â  Â  Â Â 
Â  Â  Â  // Ocultar todos los bloques de contenido (que son hijos directos de main-content)
Â  Â  Â  mainContentDiv.querySelectorAll(':scope > div').forEach(d => {
Â  Â  Â  Â  d.style.display = 'none';
Â  Â  Â  });

Â  Â  Â  // Mostrar el bloque de contenido solicitado
Â  Â  Â  const target = document.getElementById('presenter-' + contentId + '-content');
Â  Â  Â  if (target) {
Â  Â  Â  Â  target.style.display = 'block';
Â  Â  Â  } else {
Â  Â  Â  Â  console.error(`Contenido ID: presenter-${contentId}-content no encontrado.`);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Ajustar la clase activa de la barra lateral
Â  Â  Â  document.querySelectorAll('.sidebar ul li a').forEach(a => a.classList.remove('active'));
Â  Â  Â  const match = document.querySelector(`.sidebar ul li a[onclick*="${contentId}"]`);
Â  Â  Â  if (match) match.classList.add('active');

Â  Â  Â  // LÃ³gica especÃ­fica al cargar la "pÃ¡gina"
Â  Â  Â  if (contentId === 'live-session') {
Â  Â  Â  Â  document.getElementById('total-slides').textContent = totalSlides;
Â  Â  Â  Â  document.getElementById('current-slide').textContent = currentSlide;
Â  Â  Â  Â  document.getElementById('current-presentation-title').textContent = currentPresentation || '--';
Â  Â  Â  Â  // Simular o mostrar contenido de la diapositiva
Â  Â  Â  Â  if (!pdfDoc) {
Â  Â  Â  Â  Â  Â  Â document.getElementById('current-slide-content').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â document.getElementById('pdf-canvas').style.display = 'none';
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Si hay un PDF cargado, se renderiza la pÃ¡gina
Â  Â  Â  Â  Â  Â  renderPDFPage(currentSlide);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  if (contentId === 'spectator-management') updateSpectatorList();Â 
Â  Â  Â  if (contentId === 'reports') updateAttendanceReport();
Â  Â  Â  if (contentId === 'presentations') loadPresentationsListUI();
Â  Â  Â  if (contentId === 'course-materials') loadMaterialsListUI();
Â  Â  Â  if (contentId === 'questions') loadSavedQuestions();
Â  Â  }

Â  Â  /************************************************************************
Â  Â  Â * AUTH (SIMULACIÃ“N FORZADA)
Â  Â  Â ************************************************************************/
Â  Â  async function authenticateUser(){
Â  Â  Â  const email = document.getElementById('email').value.trim();
Â  Â  Â  const password = document.getElementById('password').value;
Â  Â  Â Â 
Â  Â  Â  // SIMULACIÃ“N FORZADA DE Ã‰XITO (Independiente de Supabase)
Â  Â  Â  if (true) {Â 
Â  Â  Â  Â  Â  currentUser = { id: 'demo-presenter-123', email: email, user_metadata: { name: 'Presentador Demo' } };
Â  Â  Â  Â  Â  showPage('presenter-dashboard');
Â  Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  }

Â  Â  async function registerUser(){
Â  Â  Â  alert('Funcionalidad de registro (demo).');
Â  Â  Â  toggleAuthForm();
Â  Â  }

Â  Â  async function logout(){
Â  Â  Â  currentUser = null;
Â  Â  Â  await cleanupRealtime();
Â  Â  Â  showPage('landing');
Â  Â  }

Â  Â  /************************************************************************
Â  Â  Â * SESSIONS (QR Y CÃ“DIGO)
Â  Â  Â ************************************************************************/
Â  Â  function generateQrCode(code) {
Â  Â  Â  Â  const qrImg = document.getElementById('qr-code-img');
Â  Â  Â  Â  const joinUrl = `${window.location.origin}${window.location.pathname}?session=${code}`;
Â  Â  Â  Â  qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(joinUrl)}`;
Â  Â  Â  Â  qrImg.style.display = 'block';
Â  Â  }

Â  Â  async function generateNewSession(){
Â  Â  Â  const userId = currentUser ? currentUser.id : 'demo-presenter-123';
Â  Â  Â  if (!userId) return alert('Primero inicia sesiÃ³n como presentador.');
Â  Â  Â Â 
Â  Â  Â  const code = 'AULAPUDU-' + Math.floor(10000 + Math.random()*90000);
Â  Â  Â  currentSessionCode = code;

Â  Â  Â  try {
Â  Â  Â  Â  generateQrCode(code);
Â  Â  Â  Â  document.getElementById('session-id-display').textContent = code;

Â  Â  Â  Â  await initRealtimeForSession(currentSessionCode, { asPresenter: true });
Â  Â  Â  Â Â 
Â  Â  Â  Â  alert(`Nueva sesiÃ³n creada: ${currentSessionCode}. Â¡El panel de control en tiempo real estÃ¡ activo!`);

Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error('generateNewSession', err);
Â  Â  Â  Â  alert('Error creando sesiÃ³n: ' + (err?.message || err));
Â  Â  Â  }
Â  Â  }

Â  Â  /************************************************************************
Â  Â  Â * ASISTENCIA / GESTIÃ“N DE ESPECTADORES (RT SIMULADO)
Â  Â  Â ************************************************************************/
Â  Â  async function joinSession(){
Â  Â  Â  const sessionCode = document.getElementById('session-id-input').value.trim();
Â  Â  Â  const spectatorName = document.getElementById('spectator-name').value.trim();
Â  Â  Â  if (!sessionCode || !spectatorName) return alert('Por favor, ingresa el ID de sesiÃ³n y tu nombre.');
Â  Â  Â Â 
Â  Â  Â  if (sessionCode.substring(0, 9) !== 'AULAPUDU-') return alert('ID de SesiÃ³n no vÃ¡lido (Demo).');

Â  Â  Â  try {
Â  Â  Â  Â  currentSessionCode = sessionCode;
Â  Â  Â  Â  await initRealtimeForSession(currentSessionCode, { asSpectator: true, name: spectatorName });
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('spectator-presentation-title').textContent = "SesiÃ³n en Vivo: " + sessionCode;
Â  Â  Â  Â  document.getElementById('spectator-total-slides').textContent = totalSlides;
Â  Â  Â  Â  document.getElementById('spectator-slide-number').textContent = currentSlide;
Â  Â  Â  Â Â 
Â  Â  Â  Â  showPage('spectator-interface');

Â  Â  Â  } catch(err){
Â  Â  Â  Â  console.error('joinSession', err);
Â  Â  Â  Â  alert('Error uniendo a la sesiÃ³n: ' + (err?.message || err));
Â  Â  Â  }
Â  Â  }

Â  Â  // Funciones para manipular la lista de espectadores en la UI
Â  Â  function addSpectatorToList(name) {
Â  Â  Â  Â  if (!document.getElementById('spectators-list')) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // SimulaciÃ³n: Agregar al estado local de RT
Â  Â  Â  Â  const key = name.replace(/\s/g, '-').toLowerCase();
Â  Â  Â  Â  rt.liveSpectators[key] = { name: name };
Â  Â  Â  Â Â 
Â  Â  Â  Â  updateSpectatorList();
Â  Â  }

Â  Â  function removeSpectatorFromList(name) {
Â  Â  Â  Â  if (!document.getElementById('spectators-list')) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // SimulaciÃ³n: Eliminar del estado local de RT
Â  Â  Â  Â  const key = name.replace(/\s/g, '-').toLowerCase();
Â  Â  Â  Â  delete rt.liveSpectators[key];

Â  Â  Â  Â  updateSpectatorList();
Â  Â  }

Â  Â  async function updateSpectatorList(){
Â  Â  Â  Â  const list = document.getElementById('spectators-list');
Â  Â  Â  Â  const countDisplay = document.getElementById('active-spectators');
Â  Â  Â  Â  if (!list || !countDisplay) return;

Â  Â  Â  Â  if (!currentSessionCode) {
Â  Â  Â  Â  Â  Â  list.innerHTML = '<li>Inicia una sesiÃ³n en vivo para ver los espectadores.</li>';
Â  Â  Â  Â  Â  Â  countDisplay.textContent = '0';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const spectatorsArray = Object.values(rt.liveSpectators);
Â  Â  Â  Â Â 
Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  const activeCount = spectatorsArray.length;Â 
Â  Â  Â  Â  countDisplay.textContent = activeCount;

Â  Â  Â  Â  if (activeCount === 0) {
Â  Â  Â  Â  Â  Â  list.innerHTML = '<li>No hay espectadores conectados.</li>';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  spectatorsArray.forEach(s => {
Â  Â  Â  Â  Â  Â  const item = document.createElement('li');
Â  Â  Â  Â  Â  Â  item.style.display = 'flex'; item.style.justifyContent = 'space-between'; item.style.alignItems = 'center';
Â  Â  Â  Â  Â  Â  item.style.padding = '12px 0'; item.style.borderBottom = '1px solid #eee';
Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <span>ğŸ‘¤ ${escapeHtml(s.name)} (Activo)</span>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="alert('Mensaje enviado a ${escapeHtml(s.name)}')">Mensaje</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="red" onclick="removeSpectatorFromList('${escapeHtml(s.name)}')">âœ• Salir</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  list.appendChild(item);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Funciones de Asistencia (simulaciÃ³n)
Â  Â  async function viewAttendance(){
Â  Â  Â  const rpt = document.getElementById('attendance-report');
Â  Â  Â  rpt.style.display = (rpt.style.display === 'none' ? 'block' : 'none');
Â  Â  Â  updateAttendanceReport();
Â  Â  }
Â  Â  async function updateAttendanceReport(){
Â  Â  Â  const list = document.getElementById('attendance-list');
Â  Â  Â  list.innerHTML = '<p>Funcionalidad de reporte de asistencia (demo).</p>';
Â  Â  }
Â  Â Â 
Â  Â  /************************************************************************
Â  Â  Â * PRESENTACIONES / MATERIALES (LÃ“GICA DINÃMICA Y PDF.JS)
Â  Â  Â ************************************************************************/
Â  Â Â 
Â  Â  // Dibuja los elementos de la lista 'uploadedFiles.presentations' en la UI
Â  Â  function loadPresentationsListUI() {
Â  Â  Â  const ul = document.getElementById('presentations-list');
Â  Â  Â  ul.innerHTML = '';
Â  Â  Â  if (uploadedFiles.presentations.length === 0) {
Â  Â  Â  Â  ul.innerHTML = '<li>No hay presentaciones subidas. Utiliza el formulario de arriba.</li>';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  uploadedFiles.presentations.forEach(p => {
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  li.style.display = 'flex'; li.style.justifyContent = 'space-between'; li.style.padding = '12px 0'; li.style.borderBottom = '1px solid #eee';
Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  <span>${p.name} (${p.type.toUpperCase()})</span>
Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  <button onclick="loadPresentation('${p.name.replace(/'/g,"\\'")}', '${p.type}', '${p.url}')">Cargar</button>
Â  Â  Â  Â  Â  Â  <button class="red" onclick="deleteFile(event, '${p.name.replace(/'/g,"\\'")}', 'presentations')">Eliminar</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  ul.appendChild(li);
Â  Â  Â  });
Â  Â  }

Â  Â  // Dibuja los elementos de la lista 'uploadedFiles.materials' en la UI
Â  Â  function loadMaterialsListUI() {
Â  Â  Â  const ul = document.getElementById('materials-list');
Â  Â  Â  ul.innerHTML = '';
Â  Â  Â  if (uploadedFiles.materials.length === 0) {
Â  Â  Â  Â  ul.innerHTML = '<li>No hay materiales subidos. Utiliza el formulario de arriba.</li>';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  uploadedFiles.materials.forEach(m => {
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='12px 0'; li.style.borderBottom='1px solid #eee';
Â  Â  Â  Â  li.innerHTML = `<span>${m.name} (${m.type.toUpperCase()})</span><button onclick="viewMaterial('${m.name.replace(/'/g,"\\'")}', '${m.type}', '${m.url}')">Ver</button>`;
Â  Â  Â  Â  ul.appendChild(li);
Â  Â  Â  });
Â  Â  }
Â  Â Â 
Â  Â  // FunciÃ³n central para eliminar archivos de la simulaciÃ³n
Â  Â  function deleteFile(event, name, type) {
Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  if (!confirm(`Â¿EstÃ¡s seguro de que deseas eliminar el archivo "${name}"? Esto es una simulaciÃ³n de Supabase Storage.`)) return;
Â  Â  Â  Â Â 
Â  Â  Â  Â  uploadedFiles[type] = uploadedFiles[type].filter(f => f.name !== name);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Actualizar la UI
Â  Â  Â  Â  if (type === 'presentations') {
Â  Â  Â  Â  Â  Â  loadPresentationsListUI();
Â  Â  Â  Â  } else if (type === 'materials') {
Â  Â  Â  Â  Â  Â  loadMaterialsListUI();
Â  Â  Â  Â  }
Â  Â  Â  Â  alert(`Archivo "${name}" eliminado.`);
Â  Â  }

Â  Â  async function uploadPresentation(){
Â  Â  Â  const input = document.getElementById('presentation-upload');
Â  Â  Â  const file = input.files[0];
Â  Â  Â  if (!file) return alert('Selecciona un archivo.');
Â  Â  Â Â 
Â  Â  Â  const uploadBtn = document.getElementById('upload-presentation-btn');
Â  Â  Â  const uploadStatus = document.getElementById('upload-presentation-status');
Â  Â  Â  uploadBtn.disabled = true;
Â  Â  Â  uploadStatus.innerHTML = '<div class="loading-spinner"></div> Subiendo presentaciÃ³n...';
Â  Â  Â  try {
Â  Â  Â  Â  const fileExt = file.name.split('.').pop().toLowerCase();
Â  Â  Â  Â  // Usar FileReader para leer el archivo localmente
Â  Â  Â  Â  const fileUrl = URL.createObjectURL(file);Â 

Â  Â  Â  Â  uploadedFiles.presentations.push({ name: file.name, type: fileExt, url: fileUrl, file });
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadPresentationsListUI(); // Actualizar la UI
Â  Â  Â  Â Â 
Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  uploadStatus.innerHTML = 'PresentaciÃ³n subida correctamente';
Â  Â  Â  Â  setTimeout(()=>{ uploadStatus.innerHTML=''; uploadBtn.disabled=false; }, 1200);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  uploadStatus.innerHTML = 'Error al subir la presentaciÃ³n';
Â  Â  Â  Â  uploadBtn.disabled = false;
Â  Â  Â  Â  console.error('uploadPresentation', err);
Â  Â  Â  }
Â  Â  }

Â  Â  async function uploadMaterial(){
Â  Â  Â  const input = document.getElementById('material-upload');
Â  Â  Â  const file = input.files[0];
Â  Â  Â  if (!file) return alert('Selecciona un archivo.');
Â  Â  Â Â 
Â  Â  Â  const uploadBtn = document.getElementById('upload-material-btn');
Â  Â  Â  const uploadStatus = document.getElementById('upload-material-status');
Â  Â  Â  uploadBtn.disabled = true;
Â  Â  Â  uploadStatus.innerHTML = '<div class="loading-spinner"></div> Subiendo material...';
Â  Â  Â  try {
Â  Â  Â  Â  const fileExt = file.name.split('.').pop().toLowerCase();
Â  Â  Â  Â  const fileUrl = URL.createObjectURL(file);

Â  Â  Â  Â  uploadedFiles.materials.push({ name: file.name, type: fileExt, url: fileUrl });
Â  Â  Â  Â Â 
Â  Â  Â  Â  loadMaterialsListUI(); // Actualizar la UI
Â  Â  Â  Â Â 
Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  uploadStatus.innerHTML = 'Material subido correctamente';
Â  Â  Â  Â  setTimeout(()=>{ uploadStatus.innerHTML=''; uploadBtn.disabled=false; }, 1200);
Â  Â  Â  } catch(err){
Â  Â  Â  Â  uploadStatus.innerHTML = 'Error al subir el material';
Â  Â  Â  Â  uploadBtn.disabled = false;
Â  Â  Â  Â  console.error('uploadMaterial', err);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  // FunciÃ³n para cargar y previsualizar la presentaciÃ³n
Â  Â  async function loadPresentation(title, type, fileUrl){
Â  Â  Â  currentPresentation = title;
Â  Â  Â  currentSlide = 1;
Â  Â  Â Â 
Â  Â  Â  document.getElementById('current-presentation-title').textContent = title;
Â  Â  Â  document.getElementById('current-presentation-text').textContent = `PresentaciÃ³n activa: ${title}`;
Â  Â  Â  document.getElementById('spectator-presentation-title').textContent = title;
Â  Â  Â  currentFileUrl = fileUrl;
Â  Â  Â  fileType = type;
Â  Â  Â  totalSlides = 10; // Valor por defecto
Â  Â  Â Â 
Â  Â  Â  const uploadStatus = document.getElementById('upload-presentation-status');
Â  Â  Â Â 
Â  Â  Â  uploadStatus.innerHTML = '<div class="loading-spinner"></div> Cargando presentaciÃ³n para previsualizaciÃ³n...';
Â  Â  Â Â 
Â  Â  Â  if (type === 'pdf' && window.pdfjsLib) {
Â  Â  Â  Â  Â  // Buscamos el objeto de archivo original
Â  Â  Â  Â  Â  const fileData = uploadedFiles.presentations.find(p => p.name === title);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (fileData && fileData.file) {
Â  Â  Â  Â  Â  Â  Â try {
Â  Â  Â  Â  Â  Â  Â  Â  // Renderizar PDF.js
Â  Â  Â  Â  Â  Â  Â  Â  pdfDoc = await pdfjsLib.getDocument(fileUrl).promise;
Â  Â  Â  Â  Â  Â  Â  Â  totalSlides = pdfDoc.numPages;
Â  Â  Â  Â  Â  Â  Â  Â  await renderPDFPage(1); // Muestra la primera pÃ¡gina
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('pdf-canvas').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-slide-content').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al renderizar PDF:", e);
Â  Â  Â  Â  Â  Â  Â  Â  totalSlides = 1;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-slide-content').innerHTML = `<h3>Error de Carga</h3><p>No se pudo renderizar el PDF. ${e.message}</p>`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('pdf-canvas').style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-slide-content').style.display = 'block';
Â  Â  Â  Â  Â  Â  Â }
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Fallback si no se encuentra el objeto File
Â  Â  Â  Â  Â  Â  totalSlides = 1;
Â  Â  Â  Â  Â  Â  document.getElementById('current-slide-content').innerHTML = `<h3>Carga Exitosa (Archivo no encontrado)</h3><p>SimulaciÃ³n de presentaciÃ³n de 1 diapositiva.</p>`;
Â  Â  Â  Â  Â  Â  document.getElementById('pdf-canvas').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.getElementById('current-slide-content').style.display = 'block';
Â  Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  // Para PPTX y otros tipos, o si PDF.js no estÃ¡ cargado
Â  Â  Â  Â  totalSlides = 1;
Â  Â  Â  Â  document.getElementById('current-slide-content').innerHTML = `<h3>Carga Exitosa (Tipo: ${type.toUpperCase()})</h3><p>La previsualizaciÃ³n en vivo solo estÃ¡ disponible para archivos PDF.</p>`;
Â  Â  Â  Â  document.getElementById('pdf-canvas').style.display = 'none';
Â  Â  Â  Â  document.getElementById('current-slide-content').style.display = 'block';
Â  Â  Â  }

Â  Â  Â  // Actualizar contadores
Â  Â  Â  document.getElementById('total-slides').textContent = totalSlides;
Â  Â  Â  document.getElementById('current-slide').textContent = currentSlide;
Â  Â  Â  document.getElementById('spectator-total-slides').textContent = totalSlides;
Â  Â  Â  document.getElementById('spectator-slide-number').textContent = currentSlide;


Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  uploadStatus.innerHTML = 'PresentaciÃ³n cargada correctamente';
Â  Â  Â  Â  Â  setTimeout(() => { uploadStatus.innerHTML = ''; showPresenterContent('live-session'); }, 1200);
Â  Â  Â  }, 800);
Â  Â  }
Â  Â Â 
Â  Â  // FunciÃ³n central para renderizar la pÃ¡gina PDF
Â  Â  async function renderPDFPage(pageNumber){
Â  Â  Â  if (!pdfDoc) return;
Â  Â  Â  const page = await pdfDoc.getPage(pageNumber);
Â  Â  Â  const canvas = document.getElementById('pdf-canvas');
Â  Â  Â  const context = canvas.getContext('2d');
Â  Â  Â  // Escalar para caber en el contenedor
Â  Â  Â  const containerWidth = document.getElementById('pdf-viewer-container').clientWidth - 40; // Restar padding
Â  Â  Â  const viewport = page.getViewport({ scale: containerWidth / page.getViewport({ scale: 1 }).width });
Â  Â  Â Â 
Â  Â  Â  canvas.height = viewport.height;
Â  Â  Â  canvas.width = viewport.width;
Â  Â  Â Â 
Â  Â  Â  const renderContext = { canvasContext: context, viewport };
Â  Â  Â  await page.render(renderContext).promise;
Â  Â  Â Â 
Â  Â  Â  currentSlide = pageNumber;
Â  Â  Â Â 
Â  Â  Â  document.getElementById('current-slide').textContent = pageNumber;
Â  Â  Â  document.getElementById('spectator-slide-number').textContent = pageNumber;
Â  Â  Â  document.getElementById('current-slide-content').style.display = 'none';
Â  Â  Â  document.getElementById('pdf-canvas').style.display = 'block';
Â  Â  Â Â 
Â  Â  Â  // La previsualizaciÃ³n no necesita reajustar el contenedor, ya se hizo en loadPresentation
Â  Â  }
Â  Â Â 
Â  Â  function viewMaterial(name, type, url){
Â  Â  Â  if (type === 'pdf' && url) {
Â  Â  Â  Â  window.open(url, '_blank');
Â  Â  Â  } else {
Â  Â  Â  Â  alert(`Visualizando ${name} (${type.toUpperCase()})`);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function nextSlide(){
Â  Â  Â  if (currentSlide < totalSlides) {
Â  Â  Â  Â  currentSlide++;
Â  Â  Â  Â  if (pdfDoc) renderPDFPage(currentSlide); else updateSlide();
Â  Â  Â  Â  broadcastSlide();
Â  Â  Â  }
Â  Â  }
Â  Â  function prevSlide(){
Â  Â  Â  if (currentSlide > 1) {
Â  Â  Â  Â  currentSlide--;
Â  Â  Â  Â  if (pdfDoc) renderPDFPage(currentSlide); else updateSlide();
Â  Â  Â  Â  broadcastSlide();
Â  Â  Â  }
Â  Â  }
Â  Â  function updateSlide(){
Â  Â  Â  Â  // Esto solo se llama si NO hay PDF cargado (fallback)
Â  Â  Â  Â  document.getElementById('current-slide').textContent = currentSlide;
Â  Â  Â  Â  document.getElementById('spectator-slide-number').textContent = currentSlide;
Â  Â  Â  Â  document.getElementById('current-slide-content').innerHTML = `<h3>Diapositiva ${currentSlide}</h3><p>Contenido de la diapositiva ${currentSlide}</p>`;
Â  Â  }
Â  Â  function broadcastSlide(){
Â  Â  Â  if (rt.chan && rt.chan.send) {
Â  Â  Â  Â  try { rt.chan.send({ type:'broadcast', event:'slide', payload:{ currentSlide, totalSlides } }); console.log("[RT] Diapositiva enviada:", currentSlide); } catch(e) { console.warn('Error RT slide', e); }
Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert('Debes iniciar una sesiÃ³n con el botÃ³n "Generar Nuevo CÃ³digo QR" para sincronizar la diapositiva.');
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  /************************************************************************
Â  Â  Â * PREGUNTAS (Funcionalidad Completa de Tipos)
Â  Â  Â ************************************************************************/
Â  Â  Â 
Â  Â  // Configura los campos de opciÃ³n segÃºn el tipo de pregunta
Â  Â  function setQuestionType(type, event){
Â  Â  Â  questionType = type;
Â  Â  Â  document.querySelectorAll('.question-type-selector button').forEach(b => b.classList.remove('active'));
Â  Â  Â  if (event && event.target) event.target.classList.add('active');
Â  Â  Â  const c = document.getElementById('options-container');
Â  Â  Â Â 
Â  Â  Â  if (type === 'open-ended'){Â 
Â  Â  Â  Â  c.innerHTML = '<p>Se permite cualquier respuesta de texto corta o pÃ¡rrafo.</p>';
Â  Â  Â  Â  c.style.display='block';Â 
Â  Â  Â  } else {
Â  Â  Â  Â  c.style.display='flex';
Â  Â  Â  Â  // Reiniciar las opciones
Â  Â  Â  Â  if (type === 'true-false'){
Â  Â  Â  Â  Â  c.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="option-input"><input type="text" value="Verdadero" readonly></div>
Â  Â  Â  Â  Â  Â  <div class="option-input"><input type="text" value="Falso" readonly></div>`;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // OpciÃ³n MÃºltiple
Â  Â  Â  Â  Â  c.innerHTML = `
Â  Â  Â  Â  Â  Â  <div class="option-input"><input type="text" placeholder="OpciÃ³n 1"><button class="red" onclick="removeOption(this)">âœ•</button></div>
Â  Â  Â  Â  Â  Â  <div class="option-input"><input type="text" placeholder="OpciÃ³n 2"><button class="red" onclick="removeOption(this)">âœ•</button></div>`;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  // Habilitar/deshabilitar botÃ³n AÃ±adir OpciÃ³n
Â  Â  Â  document.querySelector('.add-option').style.display = (type === 'multiple-choice') ? 'block' : 'none';
Â  Â  }

Â  Â  function addOption(){
Â  Â  Â  const c = document.getElementById('options-container');
Â  Â  Â  const n = c.children.length + 1;
Â  Â  Â  const d = document.createElement('div');
Â  Â  Â  d.className = 'option-input';
Â  Â  Â  d.innerHTML = `<input type="text" placeholder="OpciÃ³n ${n}"><button class="red" onclick="removeOption(this)">âœ•</button>`;
Â  Â  Â  c.appendChild(d);
Â  Â  }
Â  Â Â 
Â  Â  function removeOption(btn){
Â  Â  Â  const c = document.getElementById('options-container');
Â  Â  Â  if (c.children.length > 2) btn.parentElement.remove();
Â  Â  Â  else alert('Debe haber al menos dos opciones.');
Â  Â  }
Â  Â Â 
Â  Â  function saveQuestion(){
Â  Â  Â  const title = document.getElementById('question-title').value.trim();
Â  Â  Â  if (!title) return alert('Ingresa una pregunta.');
Â  Â  Â Â 
Â  Â  Â  let options = null;
Â  Â  Â  if (questionType !== 'open-ended') {
Â  Â  Â  Â  Â  options = [];
Â  Â  Â  Â  Â  document.querySelectorAll('#options-container input').forEach(i=>{
Â  Â  Â  Â  Â  Â  if (i.value.trim()) options.push(i.value.trim());
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  if (options.length < 2) return alert('Para este tipo de pregunta, se requieren al menos dos opciones.');
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  // SimulaciÃ³n de guardar en BD
Â  Â  Â  const newQuestion = { id: savedQuestions.length + 10, title, qtype: questionType, options };
Â  Â  Â  savedQuestions.push(newQuestion);
Â  Â  Â Â 
Â  Â  Â  alert('Pregunta guardada correctamente (Demo).');
Â  Â  Â  document.getElementById('question-title').value = '';
Â  Â  Â  loadSavedQuestions();
Â  Â  }

Â  Â  Â function loadSavedQuestions(){
Â  Â  Â  const list = document.getElementById('saved-questions');
Â  Â  Â  list.innerHTML = '';
Â  Â  Â  if (savedQuestions.length === 0) {
Â  Â  Â  Â  Â  // Datos demo de inicializaciÃ³n si no hay nada guardado
Â  Â  Â  Â  Â  savedQuestions = [
Â  Â  Â  Â  Â  Â  Â  { id: 1, title: 'Â¿CuÃ¡l es la capital de Francia?', qtype: 'multiple-choice', options: ['ParÃ­s', 'Madrid', 'BerlÃ­n'] },
Â  Â  Â  Â  Â  Â  Â  { id: 2, title: 'El pudÃº es el cÃ©rvido mÃ¡s grande del mundo.', qtype: 'true-false', options: ['Verdadero', 'Falso'] },
Â  Â  Â  Â  Â  ];
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (savedQuestions && savedQuestions.length>0) {
Â  Â  Â  Â  Â  savedQuestions.forEach(q => {
Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  li.style.display='flex'; li.style.justifyContent='space-between'; li.style.alignItems='center'; li.style.padding='12px 0'; li.style.borderBottom='1px solid #eee';
Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <strong>${escapeHtml(q.title)}</strong><br><small>Tipo: ${getQuestionTypeName(q.qtype)}</small>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="useQuestionNow(this, ${q.id}, '${q.title.replace(/'/g,"\\'")}', '${q.qtype}', ${q.options ? JSON.stringify(q.options) : 'null'})">Usar ahora</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="useQuestionWithTimer(this, ${q.id}, '${q.title.replace(/'/g,"\\'")}', '${q.qtype}', ${q.options ? JSON.stringify(q.options) : 'null'})">Usar con timer</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="red" onclick="deleteQuestion(event,this,${q.id})">Eliminar</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  list.innerHTML = '<li>No hay preguntas guardadas</li>';
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function getQuestionTypeName(type){
Â  Â  Â  const types = { 'multiple-choice':'OpciÃ³n mÃºltiple', 'true-false':'Verdadero/Falso', 'open-ended':'Respuesta abierta' };
Â  Â  Â  return types[type] || type;
Â  Â  }
Â  Â  function deleteQuestion(event, buttonElement, questionId){
Â  Â  Â  event.preventDefault();
Â  Â  Â  if (!confirm('Â¿EstÃ¡s seguro de que deseas eliminar esta pregunta?')) return;
Â  Â  Â  savedQuestions = savedQuestions.filter(q => q.id !== questionId);
Â  Â  Â  alert('Pregunta eliminada correctamente (Demo).');
Â  Â  Â  loadSavedQuestions();
Â  Â  }
Â  Â  function useQuestionNow(buttonElement, questionId, title, qtype, options){
Â  Â  Â  if (!rt.chan) return alert('Debes iniciar una sesiÃ³n en vivo primero (botÃ³n Generar CÃ³digo QR).');
Â  Â  Â  alert(`Mostrando pregunta a espectadores: ${title}`);
Â  Â  Â  if (rt.chan && rt.chan.send) {
Â  Â  Â  Â  try { rt.chan.send({ type:'broadcast', event:'question', payload:{ questionId, title, qtype, options, mode:'now' } }); console.log("[RT] Pregunta enviada:", title); } catch(e){ console.warn('Error RT question', e); }
Â  Â  Â  }
Â  Â  }
Â  Â  function useQuestionWithTimer(buttonElement, questionId, title, qtype, options){
Â  Â  Â  if (!rt.chan) return alert('Debes iniciar una sesiÃ³n en vivo primero (botÃ³n Generar CÃ³digo QR).');
Â  Â  Â  alert(`Mostrando pregunta con temporizador a espectadores: ${title}`);
Â  Â  Â  if (rt.chan && rt.chan.send) {
Â  Â  Â  Â  try { rt.chan.send({ type:'broadcast', event:'question', payload:{ questionId, title, qtype, options, mode:'timer' } }); console.log("[RT] Pregunta con timer enviada:", title); } catch(e){ console.warn('Error RT question', e); }
Â  Â  Â  }
Â  Â  }


Â  Â  /************************************************************************
Â  Â  Â * REALTIME (MANTENIDO)
Â  Â  Â ************************************************************************/
Â  Â  async function initRealtimeForSession(sessionCode, opts = {}) {
Â  Â  Â  await cleanupRealtime();

Â  Â  Â  rt.sessionId = sessionCode;Â 
Â  Â  Â Â 
Â  Â  Â  try {
Â  Â  Â  Â  const topic = `realtime:${sessionCode}`;
Â  Â  Â  Â  const chan = supa.channel(topic, {Â 
Â  Â  Â  Â  Â  Â  config: { broadcast: true, presence: { key: opts.asSpectator ? 'spectator' : 'presenter' } }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  rt.chan = chan;

Â  Â  Â  Â  // Escucha de Reacciones (para Presentador)
Â  Â  Â  Â  chan.on('broadcast', { event: 'reaction' }, (payload) => {
Â  Â  Â  Â  Â  if (opts.asPresenter) {
Â  Â  Â  Â  Â  Â  const k = payload.payload.kind;
Â  Â  Â  Â  Â  Â  reactionCounts[k] = (reactionCounts[k] || 0) + 1;
Â  Â  Â  Â  Â  Â  updateReactionCounts();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  // SimulaciÃ³n de Presencia (AÃ±adir/Eliminar Espectadores en el estado local)
Â  Â  Â  Â  chan.on('presence', { event: 'join' }, ({ newPresences }) => {
Â  Â  Â  Â  Â  Â  newPresences.forEach(p => addSpectatorToList(p.name || 'Espectador AnÃ³nimo'));
Â  Â  Â  Â  });
Â  Â  Â  Â  chan.on('presence', { event: 'leave' }, ({ leftPresences }) => {
Â  Â  Â  Â  Â  Â  leftPresences.forEach(p => removeSpectatorFromList(p.name || 'Espectador AnÃ³nimo'));
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  await chan.subscribe(async (status) => {
Â  Â  Â  Â  Â  Â  if (status === 'SUBSCRIBED') {
Â  Â  Â  Â  Â  Â  Â  Â  rt.presenceKey = `${Date.now()}-${Math.random().toString(36).slice(2,9)}`;
Â  Â  Â  Â  Â  Â  Â  Â  const name = opts.name || (opts.asPresenter ? (currentUser?.user_metadata?.name || 'Presentador RT') : 'Espectador AnÃ³nimo');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await chan.track({ name: name, id: rt.presenceKey });
Â  Â  Â  Â  Â  Â  Â  Â  console.log(`[RT] ConexiÃ³n establecida. Usuario: ${name}`);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Demo: Al unirse la sesiÃ³n, agregamos a 2 espectadores simulados
Â  Â  Â  Â  Â  Â  Â  Â  if (opts.asPresenter) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addSpectatorToList('Andrea Paz');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  addSpectatorToList('Carlos Ruiz');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  } catch(err){
Â  Â  Â  Â  console.warn('initRealtimeForSession err', err);
Â  Â  Â  Â  // Fallback: Si Supabase falla, usamos un objeto simulado para que .send() no dÃ© error
Â  Â  Â  Â  rt.chan = {Â 
Â  Â  Â  Â  Â  Â  send: (msg) => { console.warn("RT SIMULADO: Mensaje enviado localmente.", msg); } ,
Â  Â  Â  Â  Â  Â  untrack: () => Promise.resolve(),
Â  Â  Â  Â  Â  Â  unsubscribe: () => Promise.resolve(),
Â  Â  Â  Â  };
Â  Â  Â  Â  // Simulamos que al menos un espectador se une en modo demo
Â  Â  Â  Â  rt.liveSpectators['demo-1'] = { name: 'Espectador Demo' };
Â  Â  Â  Â  alert("Advertencia: No se pudo conectar a Supabase Realtime. El panel funcionarÃ¡ en modo DEMO local (sin Realtime con otros usuarios).");
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  async function cleanupRealtime(){
Â  Â  Â  Â  if (rt.chan && rt.chan.unsubscribe) {
Â  Â  Â  Â  Â  Â  Â try { rt.chan.untrack(); } catch(e){}
Â  Â  Â  Â  Â  Â  Â try { rt.chan.unsubscribe(); } catch(e){}
Â  Â  Â  Â  }
Â  Â  Â  Â  rt = { chan:null, sessionId:null, presenceKey:null, liveSpectators: {} };
Â  Â  Â  Â  document.getElementById('connected-spectators').textContent = '0 espectadores activos';
Â  Â  }

Â  Â  /************************************************************************
Â  Â  Â * HELPERS
Â  Â  Â ************************************************************************/
Â  Â  function escapeHtml(str){
Â  Â  Â  if (!str) return '';
Â  Â  Â  return String(str).replace(/[&<>"'`=\/]/g, function(s) {
Â  Â  Â  Â  return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'})[s];
Â  Â  Â  });
Â  Â  }

Â  Â  // InicializaciÃ³n: Llama a las funciones de carga de datos demo
Â  Â  (function init(){
Â  Â  Â  try {
Â  Â  Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  Â  Â  const sessionId = urlParams.get('session');
Â  Â  Â  Â  if (sessionId) {
Â  Â  Â  Â  Â  document.getElementById('session-id-input').value = sessionId;
Â  Â  Â  Â  Â  showPage('spectator-join');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  showPage('landing');
Â  Â  Â  Â  }
Â  Â  Â  } catch(e){ showPage('landing'); }
Â  Â  })();

Â  </script>
</body>
</html>
